(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{473:function(t,e,n){"use strict";n.r(e);n(16),n(13),n(14),n(67),n(8),n(10),n(7),n(329);var r=n(1),o=n.n(r),i=n(4),a=n(102),s=n.n(a),c=n(477),u=n(476),m=n(478),l=n(507);function p(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var h=Object(i.a)("commentSystem/comment"),f=h.mapState,v=h.mapActions,g=Object(i.a)("commentSystem/user").mapGetters,y=Object(i.a)("commentSystem/app").mapState,I={data:function(){return{STATUS_DEFAULT:0,STATUS_NEW_SORTING:1,ORDER_HOT:m.d,ORDER_FRESH:m.c}},mixins:[l.a],computed:d({},f(["order","url","host","lock","status"]),{},y({appInfo:"info"}),{},g(["canModerate"]),{params:function(){return s.a.stringify({appId:this.appInfo.appId,url:this.url})},isNewOnly:function(){return 1==this.status}}),methods:d({},v({fetchComments:"FETCH_COMMENTS",_updateLock:"UPDATE_LOCK",_updateStatus:"UPDATE_STATUS"}),{changeOrder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.d;c.a.track(t===m.d?u.a.clickOrderHot:u.a.clickOrderFresh),this.fetchComments({order:t,refresh:!0})},updateLock:function(t){confirm("Admin: Confirm ".concat(t?"lock":"unlock"," post?"))&&this._updateLock(t),this.hideMenu()},updateStatus:function(t){confirm("Admin: Confirm update post sorting?")&&this._updateStatus(t),this.hideMenu()},insideMenu:function(t){return t===this.$refs.menu}})},_=n(0),b=Object(_.a)(I,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tab-bar-right"},[t.isNewOnly?t._e():n("ul",{staticClass:"tab"},[n("li",{class:{active:t.order===t.ORDER_HOT}},[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.changeOrder(t.ORDER_HOT)}}},[t._v("Hot")])]),t._v(" "),n("li",{class:{active:t.order===t.ORDER_FRESH}},[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.changeOrder(t.ORDER_FRESH)}}},[t._v("Fresh")])])]),t._v(" "),t.canModerate?n("div",{staticClass:"overflow-menu"},[n("a",{staticClass:"menu-trigger",attrs:{href:"javascript:void(0);"},on:{click:t.clickMenu}},[t._m(0)]),t._v(" "),n("div",{ref:"menu",class:{"comment-pop-menu":t.showMenu,hide:!t.showMenu}},[n("ul",[n("li",[n("a",{attrs:{target:"_blank",href:"//"+t.host+"/admin"}},[t._v("Comment Admin")])]),t._v(" "),n("li",[t.lock?t._e():n("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.updateLock(1)}}},[t._v("Lock Post")])]),t._v(" "),n("li",[t.lock?n("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.updateLock(0)}}},[t._v("Unlock Post")]):t._e()]),t._v(" "),n("li",[t.isNewOnly?t._e():n("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.updateStatus(t.STATUS_NEW_SORTING)}}},[t._v("Sort by New Only")])]),t._v(" "),n("li",[t.isNewOnly?n("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.updateStatus(t.STATUS_DEFAULT)}}},[t._v("Default Sorting")]):t._e()]),t._v(" "),n("li",[n("a",{attrs:{target:"_blank",href:"//"+t.host+"/admin/comments/search?"+t.params}},[t._v("All Comments")])]),t._v(" "),n("li",[n("a",{attrs:{target:"_blank",href:"//"+t.host+"/admin/comments/hidden?"+t.params}},[t._v("Hidden Comments")])]),t._v(" "),n("li",[n("a",{attrs:{target:"_blank",href:"//"+t.host+"/admin/comments/reported?"+t.params}},[t._v("Reported Comments")])]),t._v(" "),n("li",[n("a",{attrs:{target:"_blank",href:"//"+t.host+"/admin/comments/image-comments?"+t.params}},[t._v("Image Comments")])]),t._v(" "),n("li",[n("a",{attrs:{target:"_blank",href:"//"+t.host+"/admin/comment-score/index?"+t.params}},[t._v("Comment Score")])])])])]):t._e()])},[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"inline-icon"},[e("span",{staticClass:"dot-menu"},[e("span",{staticClass:"dot-1"}),e("span",{staticClass:"dot-2"}),e("span",{staticClass:"dot-3"})])])}],!1,null,null,null).exports,O=n(494),C=n(492),w=Object(_.a)(C.a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"comment-entry",class:t.commentEntryClasses,on:{mouseenter:function(e){return e.stopPropagation(),t.setMouseStates("hover",!0)},mouseleave:function(e){return e.stopPropagation(),t.resetMouseStates(e)},mousedown:function(e){return t.setMouseStates("active",!0)},mouseup:function(e){return t.setMouseStates("active",!1)},click:t.onItemClick}},[n("div",{staticClass:"avatar"},[n("div",{staticClass:"image-container"},[n("a",{attrs:{href:t.profileUrl,target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.clickAvatar(e)}}},[n("img",{attrs:{src:t.comment.user.avatarUrl}})])])]),t._v(" "),n("div",{staticClass:"payload"},[n("div",{staticClass:"info"},[n("div",{staticClass:"info-container"},[n("a",{ref:"username",staticClass:"username",attrs:{href:t.profileUrl,target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.clickName(e)}}},[t._v(t._s(t.comment.user.displayName))]),t._v(" "),t.isVerifiedAccount?n("span",{staticClass:"verified-account"}):t._e(),t._v(" "),t.emojiStatus?n("span",{ref:"emojiStatus",staticClass:"status"},[t._v(t._s(t.emojiStatus))]):t._e(),t._v(" "),t.isProPlus&&!t.hideProBadge?n("span",{staticClass:"badge pro plus"},[t._v("Pro+")]):t.isPro&&!t.hideProBadge?n("span",{staticClass:"badge pro"},[t._v("Pro")]):t._e(),t._v(" "),n("span",{staticClass:"meta"},[t.isOp?n("span",[n("span",{staticClass:"label role-op",attrs:{title:"Original Poster"}},[t._v("OP")]),t._v(" "),n("span",[t._v(" · ")])]):t._e(),t._v(" "),t.pointsText?n("span",[n("span",{staticClass:"points"},[t._v(t._s(t.pointsText))]),t._v(" "),n("span",[t._v(" · ")])]):t._e(),t._v(" "),n("span",{staticClass:"time"},[n("a",{staticClass:"comment-permalink",attrs:{href:t.comment.permalink,target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.clickAge(e)}}},[t._v(t._s(t.commentAge))])])])])]),t._v(" "),n("CommentItemCommentText",{attrs:{comment:t.comment}}),t._v(" "),t.imageInfo.imageUrl?n("div",{staticClass:"media"},[n("a",{staticClass:"img-embed",attrs:{href:t.imageInfo.imageHref,target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.clickImage(e)}}},[t.imageInfo.isVideo?n("video",{ref:"gifVideo",attrs:{"data-src":t.imageInfo.imageUrl,autoplay:"",muted:"",loop:"",playsinline:"","webkit-playsinline":""},domProps:{muted:!0}}):n("picture",[t.imageInfo.webpUrl?n("source",{attrs:{srcset:t.imageInfo.webpUrl,type:"image/webp"}}):t._e(),t._v(" "),n("img",{attrs:{src:t.imageInfo.imageUrl}})])])]):t._e(),t._v(" "),n("div",{staticClass:"action"},[t.isLocked?t._e():n("span",[n("a",{staticClass:"reply",attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.onReplyClick(e)}}},[t._v("Reply")])]),t._v(" "),n("CommentItemVoteBtnView",{attrs:{comment:t.comment}}),t._v(" "),!t.isAuthor&&t.canModerate?n("span",[n("span",[n("a",{staticClass:"admin",attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.hide(e)}}},[t._v(t._s(this.hidden?"Unhide":"Hide"))])]),t._v(" "),n("span",[t.comment.type===t.TYPE_USER_MEDIA?n("a",{staticClass:"admin",attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.hideBadImage(e)}}},[t._v(t._s(this.hidden?"Unhide (Bad Image)":"Hide (Bad Image)"))]):t._e()]),t._v(" "),n("span",[n("a",{staticClass:"admin",attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.ban(e)}}},[t._v(t._s(this.banned?"Unban":"Ban"))])])]):t._e(),t._v(" "),t.canModerate?n("span",[n("span",[t.isChild?t._e():n("a",{staticClass:"admin",attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.pin(e)}}},[t._v(t._s(this.isPinned?"Unpin":"Pin"))])])]):t._e()],1)],1),t._v(" "),n("CommentItemExtraMenuView",{ref:"extraMenu",attrs:{comment:t.comment}}),t._v(" "),n("div",{staticClass:"clearfix"})],1),t._v(" "),t.replyBox?n("CommentInputView",{attrs:{"is-reply":!0,"reply-box-comment-id":t.comment.commentId,"thread-id":t.comment.threadId,"reply-mention-user":t.comment.user,"hide-reply-box":t.hideReplyBox}}):t._e(),t._v(" "),t.hideReplies?t._e():n("div",t._l(t.getChildren,function(t){return n("CommentItemView",{key:t.commentId,attrs:{comment:t,id:t.commentId}})}),1),t._v(" "),t.hasReplies?n("a",{staticClass:"collapsed-comment",class:t.loadMoreBtnClasses,attrs:{href:"javascript:void(0);"},on:{click:t.fetchMoreReplies,mouseenter:function(e){return e.stopPropagation(),t.viewRepliesMouseHandler("hover",!0)},mouseleave:function(e){return e.stopPropagation(),t.resetMouseStates(e)},mousedown:function(e){return e.stopPropagation(),t.viewRepliesMouseHandler("active",!0)},mouseup:function(e){return e.stopPropagation(),t.viewRepliesMouseHandler("active",!1)}}},[t.isLoadingReplies?t._e():n("span",[t._v(t._s(t.loadReplyText))]),t._v(" "),t.isLoadingReplies?n("span",[t._v("Loading…")]):t._e()]):t._e(),t._v(" "),n("div",t._l(t.getLocalChildren,function(t){return n("CommentItemView",{key:t.commentId,attrs:{comment:t,id:t.commentId}})}),1)],1)},[],!1,null,null,null).exports,k=n(481),T=n(480),S=n(231);function P(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var M=Object(i.a)("commentSystem/comment"),j=M.mapState,L=M.mapActions,A=M.mapMutations,U=M.mapGetters,D=Object(i.a)("commentSystem/app").mapState,R={props:["isSection"],mixins:[T.a],watch:{hasHighlightedComment:{handler:function(t){var e=this;t&&this.$nextTick(function(){e.animateHighlightComment(e.highlightedId)})},immediate:!0},order:function(){this.resetLoadMore()}},computed:E({},j(["highlightedId","comments","hasNext","isLoading","order","autoLoadCount"]),{},U(["isLocked"]),{},D({appInfo:"info"}),{showNoCommentText:function(){return!(this.isLocked||this.comments.length||this.isLoading||this.isSection)},canLoadMore:function(){return this.hasNext&&!this.isLoading&&!this.isSection},canScrollMore:function(){var t=this.appInfo.autoLoadMaxTimes,e=-1===t;return this.canLoadMore&&(e||this.autoLoadCount<t)},canShowLoading:function(){return!this.isSection&&this.isLoading},getComments:function(){return this.isSection?this.comments.filter(function(t){return""!==t.section}):this.comments.filter(function(t){return""===t.section})},hasHighlightedComment:function(){return this.isSection&&this.getComments.filter(function(t){return"highlight"===t.section}).length>0}}),components:{CommentItemView:w,LoadMore:S.a},methods:E({},A({increaseAutoLoadCount:"INCREASE_AUTO_LOAD_COUNT"}),{},L({fetchComments:"FETCH_COMMENTS",animateHighlightComment:"ANIMATE_HIGHLIGHT_COMMENT"}),{fetchMoreComments:function(t){var e=this,n=this.comments[this.comments.length-1];this.fetchComments({ref:n.orderKey,order:this.order}).then(function(n){c.a.track(u.a.loadMore,{CommentCount:e.comments.length,TriggerAction:t})})},loadMoreHandler:function(){k.a.log("scroll triggered load more comments"),this.increaseAutoLoadCount(),this.fetchMoreComments("Scroll")},resetLoadMore:function(){this.$refs.loadMore&&this.$refs.loadMore.reset()},firstToComment:function(){this.redirectLogin()||(document.getElementsByClassName("post-text-area")[0].focus(),c.a.track(u.a.clickFirstToComment))}})},x=Object(_.a)(R,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.showNoCommentText?n("div",{staticClass:"notice-message"},[n("p",{staticClass:"align-center"},[t._v("Be the first to comment!")]),t._v(" "),n("div",{staticClass:"btn-container align-center"},[n("a",{staticClass:"btn",attrs:{href:"javascript:void(0);"},on:{click:t.firstToComment}},[t._v("Say something nice")])])]):t._e(),t._v(" "),t._l(t.getComments,function(t){return n("CommentItemView",{key:t.commentId,attrs:{comment:t,id:t.commentId}})}),t._v(" "),t.canScrollMore?n("LoadMore",{key:t.$route.fullPath,ref:"loadMore",attrs:{threshold:700},on:{loadMore:t.loadMoreHandler}}):t._e(),t._v(" "),t.canShowLoading?n("div",{staticClass:"spinner-here"}):t._e(),t._v(" "),t.canLoadMore?n("div",{staticClass:"comment-pagination"},[n("div",{staticClass:"btn-container"},[n("a",{staticClass:"cmnt-btn more grey",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.fetchMoreComments("Click")}}},[n("span",{staticClass:"label"},[t._v("Load More Comments")])])])]):t._e()],2)},[],!1,null,null,null).exports,N=n(489),H=n(29),F=(n(25),n(26),n(508)),B=n(17),V=n.n(B),G=(n(58),n(24)),$=n.n(G);function K(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?K(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var q={namespaced:!0,state:{info:{appId:null,maxDisplayLevel:null,maxMessageLength:null,allowImageUploadFeature:null,opHideCommentFeature:null,anonymousAvatarUrl:null,reactionImageSite:null,mentionUrlPattern:null,refDomain:null,autoLoadMaxTimes:null,allowPostUrlComment:null}},mutations:{setAppInfo:function(t,e){t.info=e}},actions:o()({},H.a.FETCH_APP_INFO,function(){var t=$()(V.a.mark(function t(e,n){var r,o,i;return V.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.commit,!(o=e.state).info.appId||o.info.appId!==n.appId){t.next=3;break}return t.abrupt("return",Promise.resolve());case 3:return t.next=5,N.a.fetchAppInfo();case 5:i=t.sent,r("setAppInfo",W({appId:n.appId,autoLoadMaxTimes:n.autoLoadMaxTimes||7},i));case 7:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())},z=n(562),Y=n(97);function J(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Z=Object(i.a)("commentSystem/comment"),X=Z.mapState,tt=Z.mapMutations,et=Z.mapActions,nt=Object(i.a)("commentSystem/app").mapActions,rt=Object(i.a)("commentSystem/user").mapActions,ot={props:{post:Object,commentAuth:String,commentOptions:Object,reportPromise:Function,showTotal:{type:Boolean,default:!1}},components:{TabBarOrderView:b,CommentInputView:O.a,CommentListView:x},watch:{post:function(t){t&&this.init()},commentAuth:function(t){this.init()}},methods:Q({},tt({setHighlightedId:"SET_HIGHLIGHTED_ID",setCommentInfo:"SET_COMMENT_INFO"}),{},et({fetchComments:"FETCH_COMMENTS"}),{},nt({fetchAppInfo:H.a.FETCH_APP_INFO}),{},rt({fetchUserInfo:H.b.FETCH_USER_INFO}),{init:function(){var t=this,e=Q({},this.initOptions);if(location.hash){var n,r=s.a.parse(location.hash.substr(1));r.cs_comment_id&&(n=r.cs_comment_id,this.setHighlightedId(n),e.highlightedId=n)}k.a.log("CommentSystem.init",e),N.a.init(e),m.f.init(e),this.setCommentInfo(e);var o=this.fetchAppInfo(e),i=this.fetchUserInfo(e);Promise.all([o,i]).then(function(){t.fetchComments({refresh:!0})})}}),computed:Q({},X(["commentsCount","lock"]),{initOptions:function(){return Q({},this.commentOptions,{url:this.post.url,postKey:this.post.id,auth:this.commentAuth,reportPromise:this.reportPromise})}}),created:function(){this.$store.state.commentSystem||(this.$store.registerModule("commentSystem",{namespaced:!0,modules:{comment:F.a,app:q,user:z.a}}),function(t){Object(Y.a)({key:"comment::appState",paths:["commentSystem.app.info"],filter:function(t){return["commentSystem/app/setAppInfo"].includes(t.type)}},600)(t),Object(Y.a)({key:"comment::userState",paths:["commentSystem.user.auth","commentSystem.user.info","commentSystem.user.commentedPostUrls","commentSystem.user.reportedPostUrls","commentSystem.user.likeMapping"],filter:function(t){return["commentSystem/user/setAuth","commentSystem/user/setUserInfo","commentSystem/user/updateCommentedPostUrls","commentSystem/user/updateReportedPostUrls","commentSystem/user/updateLikeMapping"].includes(t.type)}},600)(t)}(this.$store)),this.init()}},it=Object(_.a)(ot,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CS3"},[n("div",{staticClass:"tab-bar clearfix"},[t.showTotal?n("div",{staticClass:"tab-bar-left"},[n("h3",[t._v(t._s(t.commentsCount)+" Comments")])]):t._e(),t._v(" "),n("TabBarOrderView")],1),t._v(" "),n("div",{staticClass:"comment-embed"},[t.lock?n("div",{staticClass:"notice-message"},[n("p",{staticClass:"align-center"},[t._v("This post is locked.")])]):t._e(),t._v(" "),n("CommentInputView"),t._v(" "),n("CommentListView",{attrs:{"is-section":"1"}}),t._v(" "),n("CommentListView")],1)])},[],!1,null,null,null);e.default=it.exports},476:function(t,e,n){"use strict";var r="CommentAction",o={writeComment:{c:r,a:"WriteComment",l:""},addComment:{c:r,a:"AddComment",l:"Add"},replyComment:{c:r,a:"AddComment",l:"Reply"},deleteComment:{c:r,a:"DeleteComment",l:""},upvoteComment:{c:r,a:"UpvoteComment",l:""},downvoteComment:{c:r,a:"DownvoteComment",l:""},unvoteComment:{c:r,a:"UnvoteComment",l:""},reportComment:{c:r,a:"ReportComment",l:""},opHideComment:{c:r,a:"OpHideComment",l:""},followThreadByReply:{c:r,a:"FollowThreadByReply",l:""},unfollowThreadByReply:{c:r,a:"UnfollowThreadByReply",l:""},clickOrderHot:{c:r,a:"TapHot",l:""},clickOrderFresh:{c:r,a:"TapFresh",l:""},openCommentMenu:{c:r,a:"TapCommentMenu",l:"Open"},closeCommentMenu:{c:r,a:"TapCommentMenu",l:"Close"},clickReply:{c:r,a:"TapReply",l:""},loadMore:{c:r,a:"LoadList",l:""},clickLoadMoreReply:{c:r,a:"TapLoadMoreReply",l:""},clickImage:{c:r,a:"TapImage",l:""},clickAvatar:{c:r,a:"TapAvatar",l:""},clickAuthorName:{c:r,a:"TapAuthorName",l:""},clickMention:{c:r,a:"TapMention",l:""},clickMemeUpload:{c:r,a:"TapMemeUpload",l:""},clickCommentAge:{c:r,a:"TapCommentTime",l:""},redirectLogin:{c:r,a:"RedirectLogin",l:""},clickFirstToComment:{c:r,a:"TapFirstToComment",l:""},clickFollowThread:{c:r,a:"TapFollowThread",l:""},clickUnfollowThread:{c:r,a:"TapUnfollowThread",l:""},clickCommentItem:{c:r,a:"TapCommentItem",l:""},clickCommentItemForReply:{c:r,a:"TapCommentItemForReply",l:""},closeCommentInput:{c:r,a:"CloseCommentInput",l:""}};e.a=o},477:function(t,e,n){"use strict";var r=n(508),o=n(478),i=n(481),a=n(33),s={track:function(t,e){i.a.log("Event tracking",t,e),e=this.formatCustomVaribles(e),a.default.track(t.c,t.a,t.l,"",e)},convertOrderName:function(t){return t==o.c?"Fresh":"Hot"},formatCustomVaribles:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.a.state.postKey&&(t.PostKey=r.a.state.postKey);var e=r.a.state.order;return t.CommentOrder=this.convertOrderName(e),t}};e.a=s},478:function(t,e,n){"use strict";n(16),n(13),n(8),n(10),n(7),n(14);var r=n(17),o=n.n(r),i=n(1),a=n.n(i),s=(n(58),n(24)),c=n.n(s),u=n(12),m=n.n(u),l=n(11),p=n.n(l),d=n(48),h=n.n(d),f=n(30),v=n.n(f),g=n(47),y=n.n(g),I=n(36),_=n.n(I),b=n(102),O=n.n(b),C=n(101),w=n.n(C);n(67);function k(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(n,!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var S=function(){function t(){m()(this,t),this.options={},this.FILE_SIZE_LIMIT=10485760}return p()(t,[{key:"init",value:function(t){this.options=T({},this.options,{},t)}},{key:"baseUrl",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||this.options.version;return"https://".concat(this.options.host,"/").concat(t)}},{key:"baseCdnUrl",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||this.options.version;return"https://".concat(this.options.cdnHost,"/").concat(t,"/cacheable")}},{key:"returnError",value:function(t){return Promise.reject(t.response?t.response.data:t)}},{key:"fetchFollowStatus",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.threadId,r="/v1/follow-thread-status",i={threadId:n},t.prev=3,t.next=6,_.a.post(r,i);case 6:return a=t.sent,t.abrupt("return",a.data.data);case 10:return t.prev=10,t.t0=t.catch(3),t.abrupt("return",this.returnError(t.t0));case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e){return t.apply(this,arguments)}}()},{key:"updateFollowStatus",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i,a,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.threadId,r=e.follow,i="/v1/follow-thread",a={threadId:n,follow:r},t.prev=3,t.next=6,_.a.post(i,a);case 6:return s=t.sent,t.abrupt("return",s.data.data);case 10:return t.prev=10,t.t0=t.catch(3),t.abrupt("return",this.returnError(t.t0));case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e){return t.apply(this,arguments)}}()},{key:"addComment",value:function(){var t=c()(o.a.mark(function t(){var e,n,r,i,s,c,u,m,l=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=l.length>0&&void 0!==l[0]?l[0]:{},n="".concat(this.baseUrl(),"/comment.json"),(r=w()(T({},this.options,{},e),["appId","auth","url","text","parent","replyThreadOnly","userMedia","hash","delegateUserId"])).userMedia&&(r.userMedia=JSON.stringify([r.userMedia])),t.prev=4,t.next=7,_.a.post(n,O.a.stringify(r));case 7:return s=t.sent,c=s.data.payload,u=c.comment,m=c.quota,t.abrupt("return",(i={},a()(i,r.url,u),a()(i,"quota",m),i));case 12:return t.prev=12,t.t0=t.catch(4),t.abrupt("return",this.returnError(t.t0));case 15:case"end":return t.stop()}},t,this,[[4,12]])}));return function(){return t.apply(this,arguments)}}()},{key:"uploadMedia",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat(this.baseUrl(),"/media.json"),/\/(gif|jpe?g|png|mp4|webm)$/i.test(e.type)){t.next=3;break}return t.abrupt("return",Promise.reject({code:"IMAGE_INVALID_TYPE"}));case 3:if(!(e.size&&e.size>this.FILE_SIZE_LIMIT)){t.next=5;break}return t.abrupt("return",Promise.reject({code:"IMAGE_INVALID_SIZE"}));case 5:return(r=new FormData).append("auth",this.options.auth),r.append("appId",this.options.appId),r.append("blob",e),t.prev=9,t.next=12,_.a.post(n,r);case 12:return i=t.sent,t.abrupt("return",i.data.payload.data);case 16:return t.prev=16,t.t0=t.catch(9),t.abrupt("return",this.returnError(t.t0));case 19:case"end":return t.stop()}},t,this,[[9,16]])}));return function(e){return t.apply(this,arguments)}}()},{key:"updateLike",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/like.json"),r=w()(T({},this.options,{},e),["appId","auth","commentId","value"]),t.prev=2,t.next=5,_.a.post(n,O.a.stringify(r));case 5:return i=t.sent,t.abrupt("return",i.data.payload);case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",this.returnError(t.t0));case 12:case"end":return t.stop()}},t,this,[[2,9]])}));return function(e){return t.apply(this,arguments)}}()},{key:"deleteComment",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/comment.json"),(r=w()(T({},this.options,{},e),["appId","auth","url"]))._method="DELETE",r.id=e.commentId,t.prev=4,t.next=7,_.a.post(n,O.a.stringify(r));case 7:return i=t.sent,t.abrupt("return",i.data.payload);case 11:return t.prev=11,t.t0=t.catch(4),t.abrupt("return",this.returnError(t.t0));case 14:case"end":return t.stop()}},t,this,[[4,11]])}));return function(e){return t.apply(this,arguments)}}()},{key:"reportComment",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/report.json"),(r=w()(T({},this.options,{},e),["appId","auth","url","commentId","userReportData"])).userReportData=JSON.stringify(r.userReportData),t.prev=3,t.next=6,_.a.post(n,O.a.stringify(r));case 6:return i=t.sent,t.abrupt("return",i.data.payload);case 10:return t.prev=10,t.t0=t.catch(3),t.abrupt("return",this.returnError(t.t0));case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e){return t.apply(this,arguments)}}()},{key:"opHideComment",value:function(){var t=c()(o.a.mark(function t(e){var n,r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/op/hide"),r=w()(T({},this.options,{},e),["appId","url","auth","commentId"]),t.prev=2,t.next=5,_.a.post(n,O.a.stringify(r));case 5:return i=t.sent,t.abrupt("return",i.data.payload);case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",this.returnError(t.t0));case 12:case"end":return t.stop()}},t,this,[[2,9]])}));return function(e){return t.apply(this,arguments)}}()},{key:"_adminAction",value:function(){var t=c()(o.a.mark(function t(e,n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,_.a.post(e,O.a.stringify(n));case 3:return r=t.sent,t.abrupt("return",r.data.payload);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",this.returnError(t.t0));case 10:case"end":return t.stop()}},t,this,[[0,7]])}));return function(e,n){return t.apply(this,arguments)}}()},{key:"ban",value:function(){var t=c()(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/admin/ban"),t.abrupt("return",this._banAction(n,e));case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"unban",value:function(){var t=c()(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/admin/unban"),t.abrupt("return",this._banAction(n,e));case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_banAction",value:function(){var t=c()(o.a.mark(function t(e,n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=w()(T({},this.options,{},n),["appId","userId","auth"]),t.abrupt("return",this._adminAction(e,r));case 2:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"hide",value:function(){var t=c()(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/admin/hide"),t.abrupt("return",this._hideAction(n,e));case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"unhide",value:function(){var t=c()(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/admin/unhide"),t.abrupt("return",this._hideAction(n,e));case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_hideAction",value:function(){var t=c()(o.a.mark(function t(e,n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=w()(T({},this.options,{},n),["appId","commentId","url","badImage","auth"]),t.abrupt("return",this._adminAction(e,r));case 2:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"updatePost",value:function(){var t=c()(o.a.mark(function t(e){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/admin/update"),r=w()(T({},this.options,{},e),["appId","url","auth","lock","status"]),t.abrupt("return",this._adminAction(n,r));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"pinComment",value:function(){var t=c()(o.a.mark(function t(e){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.baseUrl(),"/admin/pin"),r=w()(T({},this.options,{},e),["appId","url","auth","commentId","pinned"]),t.abrupt("return",this._adminAction(n,r));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}();function P(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(n,!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}n.d(e,"d",function(){return M}),n.d(e,"c",function(){return j}),n.d(e,"e",function(){return L}),n.d(e,"b",function(){return A}),n.d(e,"a",function(){return U});var M="score",j="ts",L="userMedia",A="STATIC",U="ANIMATED",D=function(t){function e(){var t;return m()(this,e),(t=h()(this,v()(e).call(this))).options={version:"v1",order:M,count:10,direction:"desc"},t}return y()(e,t),p()(e,[{key:"fetchComments",value:function(){var t=c()(o.a.mark(function t(){var e,n,r,i,s,c=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:{},n=w()(E({},this.options,{},e),["appId","url","count","level","order","refCommentId","ref"]),this.options.highlightedId&&(n.commentId=this.options.highlightedId),t.prev=3,r="comment-list.json",e.useCDN?(n.origin=window.location.origin,i=_.a.get("".concat(this.baseCdnUrl(),"/").concat(r),{params:n})):(n.auth=this.options.auth,i=_.a.post("".concat(this.baseUrl(),"/").concat(r),O.a.stringify(n))),t.next=8,i;case 8:return s=t.sent,t.abrupt("return",a()({},n.url,s.data.payload));case 12:return t.prev=12,t.t0=t.catch(3),t.abrupt("return",this.returnError(t.t0));case 15:case"end":return t.stop()}},t,this,[[3,12]])}));return function(){return t.apply(this,arguments)}}()}]),e}(S);e.f=new D},480:function(t,e,n){"use strict";n(16),n(13),n(8),n(10),n(7),n(14);var r=n(1),o=n.n(r),i=n(4),a=n(477),s=n(476),c=n(64);function u(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}var m=Object(i.a)("commentSystem/user").mapGetters,l=Object(i.a)("commentSystem/comment").mapState;e.a={mixins:[c.a],computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},m({_isLoggedIn:"isLoggedIn"}),{},l({postUrl:"url"})),methods:{redirectLogin:function(){if(!this._isLoggedIn)return a.a.track(s.a.redirectLogin),this.loginCallback(),!0},loginCallback:function(){var t="".concat(this.postUrl,"#comment");this.ensureLoggedIn(t)}}}},481:function(t,e,n){"use strict";var r={log:function(){},logWithData:function(t,e){}};e.a=r},489:function(t,e,n){"use strict";n(16),n(13),n(8),n(10),n(7),n(14);var r=n(17),o=n.n(r),i=(n(58),n(24)),a=n.n(i),s=n(1),c=n.n(s),u=n(12),m=n.n(u),l=n(11),p=n.n(l),d=n(36),h=n.n(d),f=n(102),v=n.n(f),g=n(101),y=n.n(g);function I(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}var _=function(){function t(){m()(this,t),this.options={version:"v1"}}return p()(t,[{key:"init",value:function(t){this.options=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(n,!0).forEach(function(e){c()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this.options,{},t)}},{key:"baseUrl",value:function(){return"https://".concat(this.options.host,"/").concat(this.options.version)}},{key:"baseCdnUrl",value:function(){return"https://".concat(this.options.cdnHost,"/").concat(this.options.version,"/cacheable")}},{key:"fetchAppInfo",value:function(){var t=a()(o.a.mark(function t(){var e,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="".concat(this.baseCdnUrl(),"/app.json"),t.prev=1,t.next=4,h.a.get(e,{params:{id:this.options.appId}});case 4:return n=t.sent,t.abrupt("return",n.data.payload.app);case 8:t.prev=8,t.t0=t.catch(1);case 10:case"end":return t.stop()}},t,this,[[1,8]])}));return function(){return t.apply(this,arguments)}}()},{key:"fetchUserInfo",value:function(){var t=a()(o.a.mark(function t(){var e,n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="".concat(this.baseUrl(),"/user.json"),n=y()(this.options,["appId","auth"]),t.prev=2,t.next=5,h.a.post(e,v.a.stringify(n));case 5:return r=t.sent,t.abrupt("return",r.data.payload);case 9:t.prev=9,t.t0=t.catch(2);case 11:case"end":return t.stop()}},t,this,[[2,9]])}));return function(){return t.apply(this,arguments)}}()}]),t}();e.a=new _},490:function(t,e,n){"use strict";(function(t){n(16),n(13),n(8),n(10),n(7),n(14),n(190),n(330),n(32),n(104);var r=n(1),o=n.n(r),i=n(477),a=n(476),s=n(4);function c(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}var u=Object(s.a)("commentSystem/app").mapState;e.a={props:["comment"],computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},u({appInfo:"info"})),methods:{clickMention:function(t){i.a.track(a.a.clickMention,{CommentId:this.comment.commentId,CommentLevel:this.comment.level,Url:t})}},render:function(){var e=this,n=arguments[0],r=[],o=[],i=t.htmlDecode(this.comment.mediaText);if(i.replace(/@[a-z0-9_]+/gi,function(t,r){var i=e.comment.mentionMapping;if(i[t]){var a=e.appInfo.mentionUrlPattern+i[t];o.push({start:r,end:r+t.length,el:n("a",{attrs:{target:"_blank",href:a},on:{click:e.clickMention.bind(e,a)}},[t])})}return t}),i.replace(/\n/g,function(t,e){return o.push({start:e,end:e+t.length,el:n("br")}),t}),this.comment.user.isVerifiedAccount){var a=new RegExp(t.urlRegExp(),"g");i.replace(a,function(t,e,r,i){return o.push({start:i,end:i+t.length,el:n("a",{attrs:{target:"_blank",href:t}},[t])}),t})}o.sort(function(t,e){return t.start-e.start});var s=0;return o.forEach(function(t){s!==t.start&&(r.push(i.substring(s,t.start)),s=t.start),r.push(t.el),s=t.end}),s!==i.length&&r.push(i.substring(s,i.length)),n("div",{class:"content"},[r.map(function(t){return t})])}}}).call(this,n(53).default)},491:function(t,e,n){"use strict";(function(t){n(16),n(13),n(8),n(10),n(14),n(565),n(67),n(7),n(328);var r=n(1),o=n.n(r),i=n(481),a=n(4),s=n(477),c=n(476),u=n(480),m=n(507);function l(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var d=Object(a.a)("commentSystem/comment"),h=d.mapState,f=d.mapActions,v=d.mapGetters,g=Object(a.a)("commentSystem/user"),y=g.mapState,I=g.mapGetters,_=Object(a.a)("commentSystem/app").mapState;e.a={props:["comment"],mixins:[u.a,m.a],computed:p({},h(["reportPromise","opUserId"]),{},v(["getFollowStatus"]),{},y({userInfo:"info"}),{},I(["isLoggedIn"]),{},_({appInfo:"info"}),{commentId:function(){return this.comment.commentId},threadId:function(){return this.comment.threadId},isFollowed:function(){return this.threadId&&this.getFollowStatus(this.threadId)},followBtnText:function(){return this.isFollowed?"Unfollow Comment":"Follow Comment"},isAuthor:function(){return this.isLoggedIn&&t.endsWith(this.comment.user.userId,this.userInfo.userId)},canShowFollow:function(){return!!this.threadId},canShowReport:function(){return!this.isAuthor},canShowDelete:function(){return!this.comment.childrenTotal&&this.isAuthor},canShowOpDelete:function(){return this.appInfo.opHideCommentFeature&&this.isLoggedIn&&!this.isAuthor&&t.endsWith(this.opUserId,this.userInfo.userId)},canShowMainMenu:function(){return this.canShowDelete||this.canShowReport}}),methods:p({},f({_deleteComment:"DELETE_COMMENT",_opHideComment:"OP_HIDE_COMMENT",_reportComment:"REPORT_COMMENT",fetchFollowStatus:"FETCH_FOLLOW_STATUS",updateFollowStatus:"UPDATE_FOLLOW_STATUS"}),{deleteComment:function(){var t=this,e=p({},this.comment);this._deleteComment({commentId:this.commentId}).then(function(){s.a.track(c.a.deleteComment,{CommentId:e.commentId,CommentLevel:e.level})}).catch(function(){t.hideMenu()})},opHideComment:function(){var t=this;this._opHideComment({commentId:this.commentId}).then(function(){s.a.track(c.a.opHideComment,{CommentId:comment.commentId,CommentLevel:comment.level})}).catch(function(){t.hideMenu()})},dislikeComment:function(){this.reportComment(function(){return Promise.resolve({reportType:12})})},reportComment:function(t){var e=this;if(!this.redirectLogin()){var n=p({},this.comment);t(this.comment).then(function(t){return i.a.log("report promise data",t),e._reportComment({userReportData:t,commentId:e.comment.commentId})}).then(function(){s.a.track(c.a.reportComment,{CommentLevel:n.level,CommentId:n.commentId})}).catch(function(){e.hideMenu()})}},trackOpenMenu:function(){s.a.track(c.a.openCommentMenu,{CommentId:this.commentId})},trackCloseMenu:function(){s.a.track(c.a.closeCommentMenu,{CommentId:this.commentId})},insideMenu:function(t){return t===this.$refs.menu},clickExtraMenu:function(t){var e=this;this.isLoggedIn?this.fetchFollowStatus(this.threadId).finally(function(){return e.clickMenu(t)}):this.clickMenu(t)},clickFollowBtn:function(){var t=this;if(!this.redirectLogin()){var e=this.isFollowed?c.a.clickUnfollowThread:c.a.clickFollowThread;s.a.track(e,{ThreadId:this.threadId}),this.updateFollowStatus({threadId:this.threadId,follow:!this.isFollowed}).catch(function(){t.hideMenu()})}}})}}).call(this,n(53).default)},492:function(t,e,n){"use strict";(function(t,r){n(16),n(13),n(8),n(10),n(7),n(14),n(328);var o=n(1),i=n.n(o),a=n(4),s=n(510),c=n(494),u=n(509),m=n(564),l=n(478),p=n(477),d=n(476),h=n(218),f=n(563),v=n.n(f),g=n(480);function y(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(n,!0).forEach(function(e){i()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var _=Object(a.a)("commentSystem/app").mapState,b=Object(a.a)("commentSystem/comment"),O=b.mapState,C=b.mapActions,w=b.mapGetters,k=(b.mapMutations,Object(a.a)("commentSystem/user")),T=k.mapState,S=k.mapGetters;e.a={name:"CommentItemView",props:["comment"],data:function(){return{TYPE_USER_MEDIA:l.e,isLoadingReplies:!1,hidden:!1,banned:!1,pinned:null,defaultHideReplies:!0,gifVideoObserver:null,hover:!1,active:!1,replyBox:!1}},mixins:[g.a],components:{CommentItemVoteBtnView:s.a,CommentInputView:c.a,CommentItemExtraMenuView:u.a,CommentItemCommentText:m.a},mounted:function(){this.emojiStatus&&this.$refs.emojiStatus&&h.a.parse(this.$refs.emojiStatus),this.lazyLoadGifVideo()},computed:I({},_({appInfo:"info"}),{},w(["isLocked"]),{},O(["opUserId","cdnHost","replyBoxCommentId","animateHighlightId","bucketId"]),{},T({userInfo:"info"}),{},S(["canModerate","isLoggedIn"]),{commentEntryClasses:function(){return{"indent-1":this.isChild,"comment-highlight":this.hover,"comment-highlight-active":this.hover&&this.active,"comment-animate-highlight":this.animateHighlightId===this.comment.commentId}},loadMoreBtnClasses:function(){return{loading:this.isLoadingReplies,"comment-highlight":this.highlightViewRepliesBtn&&this.hover,"comment-highlight-active":this.highlightViewRepliesBtn&&this.hover&&this.active}},highlightViewRepliesBtn:function(){return this.hideReplies&&!this.replyBox&&!this.isLoadingReplies},emojiStatus:function(){return this.comment.user.emojiStatus||""},profileUrl:function(){return this.comment.user.profileUrl||""},isVerifiedAccount:function(){return!!this.comment.user.isVerifiedAccount},hideProBadge:function(){var t=this.comment.user.preferences;return!!t&&!!t.hideProBadge},isPro:function(){return this.comment.user.isActivePro},isProPlus:function(){return this.comment.user.isActiveProPlus},isOp:function(){return this.comment.user.userId===this.opUserId},isAuthor:function(){return this.isLoggedIn&&t.endsWith(this.comment.user.userId,this.userInfo.userId)},commentAge:function(){return r.getTimeAgo(this.comment.timestamp)},pointsText:function(){return this.comment.isVoteMasked&&!this.isAuthor?"Points hidden":this.points},points:function(){var t=this.comment.likeCount;if(t<=0)return"";var e=t>1?"points":"point";return"".concat(t," ").concat(e)},isChild:function(){return this.comment.level>1},hasReplies:function(){return!this.comment.isChild&&(1===this.comment.childrenTotal&&this.hideReplies||this.comment.hasNext)},lastChild:function(){var t=this.getChildren.length-1;return this.comment.children[t]},imageInfo:function(){var t=this.comment,e="",n=null,r="",o=!1;if(t.type===l.e&&t.media.length>0){var i=t.media[0].imageMetaByType;i.type===l.a&&i.video?(e=i.video.url,o=!0):i.type===l.b&&i.image&&(e=i.image.url,n=i.image.webpUrl),r="https://".concat(this.cdnHost,"/image?ref=").concat(this.appInfo.refDomain,"#").concat(e)}return{imageUrl:e,imageHref:r,webpUrl:n,videoUrl:null,isVideo:o}},getChildren:function(){return this.comment.children.filter(function(t){return!t.isLocal})},getLocalChildren:function(){return this.comment.children.filter(function(t){return t.isLocal})},isPinned:function(){return null!==this.pinned?this.pinned:this.comment.isPinned},loadReplyText:function(){if(this.hideReplies){var t="replies";return 1===this.comment.childrenTotal&&(t="reply"),"View ".concat(this.comment.childrenTotal," ").concat(t)}return"Load more replies…"},hideReplies:function(){return this.defaultHideReplies&&!this.comment.section}}),methods:I({},C({_fetchMoreReplies:"FETCH_MORE_REPLIES",fetchFollowStatus:"FETCH_FOLLOW_STATUS"}),{fetchMoreReplies:function(){var t=this;this.resetMouseStates(),1===this.comment.childrenTotal&&this.hideReplies?this.defaultHideReplies=!1:this.isLoadingReplies||(this.isLoadingReplies=!0,this._fetchMoreReplies({refCommentId:this.lastChild?this.lastChild.commentId:this.comment.commentId}).then(function(){p.a.track(d.a.clickLoadMoreReply,{ReplyCount:t.comment.children.length}),t.isLoadingReplies=!1,t.defaultHideReplies=!1}).catch(function(){t.isLoadingReplies=!1}))},onReplyClick:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.resetMouseStates(),this.redirectLogin()||(t?p.a.track(d.a.clickCommentItemForReply):p.a.track(d.a.clickReply,{CommentId:this.comment.commentId,CommentLevel:this.comment.level}),this.showReplyBox())},_hide:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={commentId:this.comment.commentId,badImage:t?1:0};this.hidden?l.f.unhide(e):l.f.hide(e),this.hidden=!this.hidden},hide:function(){this._hide()},hideBadImage:function(){this._hide(!0)},ban:function(){var t={userId:this.comment.user.userId};confirm("Admin: Confirm ".concat(this.banned?"unban":"ban"," ").concat(this.comment.user.displayName,"?"))&&(this.banned?l.f.unban(t):l.f.ban(t),this.banned=!this.banned)},pin:function(){var t=!this.isPinned,e={commentId:this.comment.commentId,pinned:t?1:0};confirm("Admin: Confirm ".concat(t?"pin":"unpin"," comment?"))&&(l.f.pinComment(e),this.pinned=t)},clickAvatar:function(){p.a.track(d.a.clickAvatar,{CommentId:this.comment.commentId,CommentLevel:this.comment.level,UserId:this.comment.user.userId,AccountId:this.comment.user.accountId})},clickName:function(){p.a.track(d.a.clickAuthorName,{CommentId:this.comment.commentId,CommentLevel:this.comment.level,UserId:this.comment.user.userId,AccountId:this.comment.user.accountId})},clickAge:function(){p.a.track(d.a.clickCommentAge,{CommentId:this.comment.commentId,CommentLevel:this.comment.level})},clickImage:function(){p.a.track(d.a.clickImage,{CommentId:this.comment.commentId,CommentLevel:this.comment.level})},resetGifVideoObserver:function(){this.gifVideoObserver&&(this.gifVideoObserver.observer.disconnect(),this.gifVideoObserver=null)},lazyLoadGifVideo:function(){this.resetGifVideoObserver(),this.$refs.gifVideo&&(this.gifVideoObserver=v()(this.$refs.gifVideo),this.gifVideoObserver.observe())},setMouseStates:function(t,e){this[t]=e},resetMouseStates:function(){this.hover=!1,this.active=!1},viewRepliesMouseHandler:function(t,e){e?this.highlightViewRepliesBtn&&this.setMouseStates(t,!0):this.setMouseStates(t,!1)},showReplyBox:function(){this.replyBox=!0,this.fetchFollowStatus(this.comment.threadId)},hideReplyBox:function(){this.replyBox=!1},onItemClick:function(){window.getSelection()&&!window.getSelection().isCollapsed||this.$refs.extraMenu.showMenu||this.replyBox||(this.isChild?this.onReplyClick(!0):this.hideReplies&&this.comment.childrenTotal>0?(this.fetchMoreReplies(),p.a.track(d.a.clickCommentItem)):this.onReplyClick(!0))}}),destroyed:function(){this.resetGifVideoObserver()}}}).call(this,n(53).default,n(62).default)},493:function(t,e,n){"use strict";(function(t,r){n(16),n(13),n(8),n(10),n(14),n(67),n(7),n(103);var o=n(1),i=n.n(o),a=n(4),s=n(478),c=n(477),u=n(476),m=n(480),l=n(29);function p(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(n,!0).forEach(function(e){i()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var h=Object(a.a)("commentSystem/app").mapState,f=Object(a.a)("commentSystem/user"),v=f.mapState,g=f.mapGetters,y=Object(a.a)("commentSystem/comment"),I=y.mapState,_=y.mapActions,b=y.mapGetters,O=Object(a.a)("toast").mapActions;e.a={data:function(){return{loading:!1,errorMessage:null,commentText:"",isReactionMode:!1,uploading:!1,media:!1,delegateUserId:null}},mixins:[m.a],props:{isReply:Boolean,replyBoxCommentId:String,threadId:String,replyMentionUser:Object,hideReplyBox:Function},computed:d({},g(["canModerate"]),{},b(["isLocked","shouldAutoFollowThread"]),{},I(["lock"]),{},h({appInfo:"info"}),{},v({userInfo:"info"}),{remainingCharactersLimit:function(){return this.appInfo.maxMessageLength-this.commentText.length},messageLengthExceeded:function(){return this.remainingCharactersLimit<0},profileUrl:function(){return this.delegateUser&&this.delegateUser.profileUrl||this.userInfo.profileUrl||"javascript:void(0)"},avatarUrl:function(){return this.delegateUser&&this.delegateUser.avatarUrl||this.userInfo.avatarUrl||this.appInfo.anonymousAvatarUrl},canPostComment:function(){return!this.loading&&(this.commentText.trim()||this.media)&&!this.messageLengthExceeded},canShowReactionButton:function(){return!this.isReactionMode&&this.appInfo.allowPostUrlComment&&this.appInfo.reactionImageSite},canShowImageUploadButton:function(){return!this.isReactionMode&&this.appInfo.allowImageUploadFeature},canShowUploadImageView:function(){return this.uploading||this.media},uploadedMediaUrl:function(){return this.media&&this.media.imageMetaByType.image.url},mentionUser:function(){return this.isReply&&this.replyMentionUser?"@".concat(this.replyMentionUser.displayName):""},canShowDelegate:function(){return this.canModerate&&this.userInfo.delegates.length>0},delegateUser:function(){var t=this;return this.delegateUserId?this.userInfo.delegates.find(function(e){return e.userId===t.delegateUserId}):null},canShowInput:function(){return null!==this.lock&&!this.isLocked},canDismiss:function(){return this.isReply&&this.hideReplyBox}}),watch:{replyMentionUser:function(t,e){this.focusInput(),t&&!e&&(this.commentText="".concat(this.mentionUser," ").concat(this.commentText))}},methods:d({},_({addComment:"ADD_COMMENT",animateHighlightComment:"ANIMATE_HIGHLIGHT_COMMENT",updateFollowStatus:"UPDATE_FOLLOW_STATUS"}),{},O({displayToast:l.d.DISPLAY_TOAST}),{clearAllInput:function(){this.commentText="",this.loading=!1,this.media=null,this.isReactionMode=!1},postComment:function(){var e=this;if(!this.redirectLogin()&&this.canPostComment){var n={text:this.commentText};this.delegateUserId&&(n.delegateUserId=this.delegateUserId),this.media&&(n.userMedia=this.media.sourceMeta,n.hash=this.media.hash),this.isReply&&(n.parent=this.replyBoxCommentId),this.loading=!0;var r=this.threadId;this.addComment(n).then(function(t){e.errorMessage="",e.clearAllInput();var o="";n.parent?(e.shouldAutoFollowThread(r)&&e.followThreadByReply(r),o=u.a.replyComment):o=u.a.addComment,c.a.track(o),e.hideReplyBox&&e.hideReplyBox(),t&&e.scrollToComment(t)}).catch(function(n){e.errorMessage=t.getCommentErrorMessage(n),e.loading=!1})}},showFollowThreadToast:function(){var t=this;return new Promise(function(e,n){t.displayToast({type:r.INFO,msg:"You will be notified where there are new replies to this comment.",linkTitle:"Unfollow",toastAction:function(){return e(!1)},dismiss:!0}),setTimeout(function(){return e(!0)},7e3)})},followThreadByReply:function(t){var e=this;this.updateFollowStatus({threadId:t,follow:!0}),c.a.track(u.a.followThreadByReply),this.showFollowThreadToast().then(function(n){n||e.unfollowThreadByReply(t)})},unfollowThreadByReply:function(t){this.updateFollowStatus({threadId:t,follow:!1}),c.a.track(u.a.unfollowThreadByReply),this.displayToast({type:r.INFO,msg:"Comment unfollowed.",dismiss:!0})},toggleReactionMode:function(t){if(this.redirectLogin())return t.preventDefault(),void t.stopPropagation();c.a.track(u.a.clickMemeUpload),this.isReactionMode=!this.isReactionMode,this.media=null,this.commentText=""},showFileInputBox:function(){this.redirectLogin()||this.$refs.imageFileInput.click()},uploadImage:function(e){var n=this,r=(e.target||e.srcElement).files[0];this.uploading=!0,s.f.uploadMedia(r).then(function(t){n.media=t,n.uploading=!1,n.$refs.imageFileInput.value=null}).catch(function(e){n.media=null,n.errorMessage=t.getCommentErrorMessage(e),n.uploading=!1,n.$refs.imageFileInput.value=null})},focusInput:function(){this.$refs.commentInput.focus()},changeDelegate:function(t){var e=t.srcElement||t.target,n=e.selectedIndex;this.delegateUserId=e[n].value},focusPostTextarea:function(){c.a.track(u.a.writeComment)},clickCancel:function(){this.canDismiss?this.hideReplyBox():this.clearAllInput(),this.canDismiss&&c.a.track(u.a.closeCommentInput)},scrollToComment:function(t){var e=this;this.$nextTick(function(){var n=document.getElementById(t);n&&(n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),e.animateHighlightComment(t))})}}),mounted:function(){this.isReply&&(this.commentText="".concat(this.mentionUser," "),this.focusInput())}}}).call(this,n(53).default,n(193).default)},494:function(t,e,n){"use strict";var r=n(493),o=n(0),i=Object(o.a)(r.a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.canShowInput?n("div",{staticClass:"comment-box first",class:{loading:t.loading,"indent-1":t.isReply}},[n("div",{staticClass:"avatar"},[n("div",{staticClass:"image-container"},[n("a",{attrs:{href:t.profileUrl,target:"_blank"}},[n("img",{attrs:{src:t.avatarUrl}})])])]),t._v(" "),n("div",{staticClass:"payload"},[t.errorMessage?n("div",{staticClass:"notice-message error"},[n("p",[t._v(t._s(t.errorMessage))]),t._v(" "),n("a",{staticClass:"close-btn",attrs:{href:"javascript:void(0)"},on:{click:function(e){t.errorMessage=""}}},[t._v("×")])]):t._e(),t._v(" "),n("div",{staticClass:"textarea-container"},[n("div",[t.isReactionMode?t._e():n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentText,expression:"commentText"}],ref:"commentInput",staticClass:"post-text-area focus",attrs:{placeholder:"Write comments..."},domProps:{value:t.commentText},on:{click:t.redirectLogin,focus:t.focusPostTextarea,input:function(e){e.target.composing||(t.commentText=e.target.value)}}}),t._v(" "),t.isReactionMode?n("input",{directives:[{name:"model",rawName:"v-model",value:t.commentText,expression:"commentText"}],staticClass:"focus",attrs:{type:"url",placeholder:"Paste Memeful URL..."},domProps:{value:t.commentText},on:{click:t.redirectLogin,input:function(e){e.target.composing||(t.commentText=e.target.value)}}}):t._e()])]),t._v(" "),t.canShowUploadImageView?n("div",{staticClass:"cmnt-image-container"},[n("div",{staticClass:"img-container",class:{loading:t.uploading}},[t.uploading?n("div",{staticClass:"spinner-here"}):t._e(),t._v(" "),t.uploading?t._e():n("img",{attrs:{src:t.uploadedMediaUrl}}),t._v(" "),t.uploading?t._e():n("div",{staticClass:"overlay"},[n("a",{staticClass:"btn-delete",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.media=null}}},[t._v("Delete")])])])]):t._e(),t._v(" "),n("div",{staticClass:"action"},[n("div",{staticClass:"lhs"},[t.canShowReactionButton?n("a",{key:"reaction",staticClass:"cmnt-reaction",attrs:{href:"https://"+this.appInfo.reactionImageSite,target:"_blank"},on:{click:t.toggleReactionMode}},[t._v("Post reaction")]):t._e(),t._v(" "),t.isReactionMode?n("a",{key:"reaction-cancel",staticClass:"cmnt-btn link grey size-30 submit-reaction",attrs:{href:"javascript:void(0);"},on:{click:t.toggleReactionMode}},[t._v("Cancel")]):t._e(),t._v(" "),t.canShowImageUploadButton?n("span",[n("a",{staticClass:"cmnt-image",attrs:{href:"javascript:void(0)"},on:{click:t.showFileInputBox}},[t._v("Post image")]),t._v(" "),n("input",{ref:"imageFileInput",staticClass:"hide",attrs:{type:"file",name:"blob"},on:{change:t.uploadImage}})]):t._e(),t._v(" "),t.canShowDelegate?n("label",{staticClass:"cmnt-identity"},[n("select",{on:{change:t.changeDelegate}},[n("option",{key:t.userInfo.userId,domProps:{value:t.userInfo.userId}},[t._v(t._s(t.userInfo.displayName)+" (Current user)")]),t._v(" "),t._l(t.userInfo.delegates,function(e){return n("option",{key:e.userId,domProps:{value:e.userId}},[t._v(t._s(e.displayName))])})],2)]):t._e()]),t._v(" "),n("div",{staticClass:"rhs"},[!t.isReactionMode&&t.messageLengthExceeded?n("p",{staticClass:"word-count",class:{red:t.messageLengthExceeded}},[n("span",[t._v(t._s(t.remainingCharactersLimit))])]):t._e(),t._v(" "),n("a",{staticClass:"cancel-input",attrs:{href:"javascript:void(0);"},on:{click:t.clickCancel}},[t._v("Cancel")]),t._v(" "),n("a",{staticClass:"cmnt-btn size-30 submit-comment",attrs:{href:"javascript:void(0);"},on:{click:t.postComment}},[t._v("Post")])])])]),t._v(" "),n("div",{staticClass:"clearfix"})]):t._e()},[],!1,null,null,null);e.a=i.exports},507:function(t,e,n){"use strict";e.a={data:function(){return{showMenu:!1}},methods:{trackOpenMenu:function(){},trackCloseMenu:function(){},insideMenu:function(t){},clickMenu:function(t){if(this.showMenu)return this.hideMenu(),void this.trackCloseMenu();t.preventDefault(),t.stopPropagation(),this.showMenu=!0,window.addEventListener("click",this.hideIfOutside),this.trackOpenMenu()},hideIfOutside:function(t){t.stopPropagation();for(var e=t.target||t.srcElement;e;){if(this.insideMenu(e))return;e=e.parentNode}this.hideMenu(),this.trackCloseMenu()},hideMenu:function(){this.showMenu&&(window.removeEventListener("click",this.hideIfOutside),this.showMenu=!1)}},destroyed:function(){this.hideMenu()}}},508:function(t,e,n){"use strict";var r=n(1),o=n.n(r),i=(n(566),n(25),n(26),n(67),n(7),n(481)),a=n(478),s=n(29),c=n(101),u=n.n(c),m=n(18);function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.forEach(function(t){e[t.commentId]=t,Array.isArray(t.children)&&t.children.length>0&&l(t.children,e)}),e}function p(t,e){return e[t]}function d(t,e){var n=t[e.commentId]||0;e.isLike.value!==n&&(e.isLike.value=n)}e.a={namespaced:!0,state:{comments:[],commentsCount:0,opUserId:null,hasNext:!1,commentsById:{},isLoading:!0,order:a.d,autoLoadCount:0,highlightedId:null,animateHighlightId:null,status:null,lock:null,url:null,cdnHost:null,host:null,enableTracking:!1,reportPromise:null,postKey:null,bucketId:"00000",followStatusMap:{}},getters:{isLocked:function(t,e,n,r){return!r["commentSystem/user/canModerate"]&&t.lock},getFollowStatus:function(t){return function(e){return t.followStatusMap[e]}},shouldAutoFollowThread:function(t,e){return function(t){return t&&!e.getFollowStatus(t)}}},mutations:{SET_COMMENT_INFO:function(t,e){t.cdnHost=e.cdnHost,t.host=e.host,t.reportPromise=e.reportPromise||function(){return Promise.resolve()},t.url=e.url,t.postKey=e.postKey,t.bucketId=e.bucketId},SET_HIGHLIGHTED_ID:function(t,e){t.highlightedId=e},SET_ANIMATE_HIGHLIGHT_ID:function(t,e){t.animateHighlightId=e},INCREASE_AUTO_LOAD_COUNT:function(t){t.autoLoadCount++},SET_LOCK:function(t,e){t.lock=e},SET_STATUS:function(t,e){t.status=e},SET_LOADING:function(t,e){t.isLoading=e},RESET_COMMENTS:function(t,e){t.comments=e,t.commentsById=l(t.comments)},SET_COMMENTS:function(t,e){t.comments=t.comments.concat(e),t.commentsById=l(t.comments)},ADD_COMMENT:function(t,e){t.comments.unshift(e),t.commentsById=l(t.comments)},ADD_REPLY:function(t,e){e.isLocal=!0,i.a.log("Add reply",e);var n=p(e.parent,t.commentsById);n.children.push(e),i.a.log("Parent comment",n),t.commentsById=l(t.comments)},CLEAR_COMMENTS:function(t,e){t.order=e||a.d,t.autoLoadCount=0,t.comments=[]},SET_COMMENTS_COUNT:function(t,e){t.commentsCount=e},SET_OP_USER_ID:function(t,e){t.opUserId=e},SET_HAS_NEXT:function(t,e){t.hasNext=e},UPDATE_COMMENT_REPLIES:function(t,e){if(i.a.log("UPDATE_COMMENT_REPLIES",e),!e.commentId)throw{message:"UPDATE_COMMENT_REPLIES state mutation called without commentId"};var n=p(e.commentId,t.commentsById),r=n.children.map(function(t){return t.commentId});n.hasNext=e.hasNext,n.children=n.children.concat(e.comments.filter(function(t){return!r.includes(t.commentId)})),t.commentsById=l(t.comments)},UPDATE_LIKE:function(t,e){var n=p(e.commentId,t.commentsById),r=e.isLike.value-n.isLike.value;n.likeCount+=r,n.isLike.value=e.isLike.value},DELETE_COMMENT:function(t,e){var n,r=p(e.commentId,t.commentsById),o=(n=r.level>1?p(r.parent,t.commentsById).children:t.comments).findIndex(function(t){return t.commentId===e.commentId});n.splice(o,1),t.commentsById=l(t.comments)},SET_FOLLOW_STATUS:function(t,e){var n=e.threadId,r=e.followed;m.a.set(t.followStatusMap,n,r)}},actions:{FETCH_COMMENTS:function(t,e){var n=t.commit,r=t.state,o=t.rootGetters,s=t.rootState;i.a.log("store fetch comment options",e);var c=o["commentSystem/user/hasActivities"];return i.a.log("fetch comment store hasActivities",c),c||(e.useCDN=!0),e.refresh&&n("CLEAR_COMMENTS",e.order),n("SET_LOADING",!0),i.a.log("fetch comment store hasActivities",e),a.f.fetchComments(e).then(function(t){if(t=t[r.url]){n("SET_OP_USER_ID",t.opUserId),n("SET_COMMENTS_COUNT",t.total),n("SET_HAS_NEXT",t.hasNext),n("SET_LOCK",t.lock),n("SET_STATUS",t.status),n("SET_LOADING",!1);var o=t.comments;return e.useCDN&&(o=function(t,e){return i.a.log("update like count from cache"),e&&t.forEach(function(t){d(e,t),t.children.forEach(function(t){d(e,t)})}),t}(t.comments,s.commentSystem.user.likeMapping)),e.refresh?n("RESET_COMMENTS",o):n("SET_COMMENTS",o),t}}).catch(function(t){return n("SET_LOADING",!1),Promise.reject(t)})},FETCH_MORE_REPLIES:function(t,e){var n=t.commit,r=t.state,o=t.rootGetters;return i.a.log("fetch more replies",e),o["commentSystem/user/hasActivities"]||(e.useCDN=!0),a.f.fetchComments(e).then(function(t){if(t=t[r.url]){var e=u()(t,["comments","hasNext"]);e.commentId=e.comments[0].parent,n("UPDATE_COMMENT_REPLIES",e)}})},ADD_COMMENT:function(t,e){var n=t.commit,r=t.state,c=t.dispatch;return a.f.addComment(e).then(function(t){if(i.a.log("comment model data",t,r.url),t=t[r.url])return t.level>1?n("ADD_REPLY",t):n("ADD_COMMENT",t),c("commentSystem/user/".concat(s.b.UPDATE_COMMENTED_POST_URLS),o()({},r.url,1),{root:!0}),t.commentId})},UPDATE_LIKE:function(t,e){var n=t.commit,r=(t.state,t.dispatch);return n("UPDATE_LIKE",e),a.f.updateLike({commentId:e.commentId,value:e.isLike.value}).then(function(){r("commentSystem/user/".concat(s.b.UPDATE_LIKE_MAPPING),o()({},e.commentId,e.isLike.value),{root:!0})})},OP_HIDE_COMMENT:function(t,e){var n=t.commit;t.state;return n("DELETE_COMMENT",e),a.f.opHideComment(e)},DELETE_COMMENT:function(t,e){var n=t.commit;t.state;return n("DELETE_COMMENT",e),a.f.deleteComment(e)},REPORT_COMMENT:function(t,e){var n=t.commit,r=t.state,i=t.dispatch;return n("DELETE_COMMENT",e),a.f.reportComment(e).then(function(){i("commentSystem/user/".concat(s.b.UPDATE_REPORTED_POST_URLS),o()({},r.url,1),{root:!0})})},UPDATE_LOCK:function(t,e){var n=t.commit;return a.f.updatePost({lock:e}).then(function(){n("SET_LOCK",!!e)})},UPDATE_STATUS:function(t,e){var n=t.commit;return a.f.updatePost({status:e}).then(function(){n("SET_STATUS",e)})},FETCH_FOLLOW_STATUS:function(t,e){var n=t.commit,r=t.getters;return e&&void 0===r.getFollowStatus(e)?a.f.fetchFollowStatus({threadId:e}).then(function(t){n("SET_FOLLOW_STATUS",{threadId:e,followed:!!t.followed})}):Promise.resolve()},UPDATE_FOLLOW_STATUS:function(t,e){var n=t.commit,r=e.threadId,o=e.follow;return a.f.updateFollowStatus({threadId:r,follow:o}).then(function(){n("SET_FOLLOW_STATUS",{threadId:r,followed:!!o})})},ANIMATE_HIGHLIGHT_COMMENT:function(t,e){var n=t.commit,r=t.state;n("SET_ANIMATE_HIGHLIGHT_ID",e),setTimeout(function(){r.animateHighlightId===e&&n("SET_ANIMATE_HIGHLIGHT_ID",null)},6e3)}}}},509:function(t,e,n){"use strict";var r=n(491),o=n(0),i=Object(o.a)(r.a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.canShowMainMenu?n("div",{staticClass:"extra-menu"},[n("a",{staticClass:"menu-trigger",attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.clickExtraMenu(e)}}},[n("span",{staticClass:"drop"})]),t._v(" "),n("div",{ref:"menu",staticClass:"comment-pop-menu",class:[t.showMenu?"active":"hide"]},[n("ul",[t.canShowFollow?n("li",[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.clickFollowBtn(e)}}},[t._v(t._s(t.followBtnText))])]):t._e(),t._v(" "),t.canShowDelete?n("li",[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.deleteComment(e)}}},[t._v("Delete comment")])]):t._e(),t._v(" "),t.canShowOpDelete?n("li",[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.opHideComment(e)}}},[t._v("Delete comment")])]):t._e(),t._v(" "),t.canShowReport?n("li",[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.reportComment(t.reportPromise)}}},[t._v("Report comment")])]):t._e(),t._v(" "),t.canShowReport?n("li",[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.dislikeComment(e)}}},[t._v("I just don't like it")])]):t._e()])])]):t._e()},[],!1,null,null,null);e.a=i.exports},510:function(t,e,n){"use strict";n(16),n(13),n(8),n(10),n(7),n(14);var r=n(1),o=n.n(r),i=n(4),a=n(477),s=n(476),c=n(480);function u(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}Object(i.a)("commentSystem/app").mapState;var m=Object(i.a)("commentSystem/comment"),l=(m.mapState,m.mapActions),p=(m.mapGetters,m.mapMutations,{props:["comment"],mixins:[c.a],data:function(){return{UPVOTE:"up",DOWNVOTE:"down"}},computed:{commentId:function(){return this.comment.commentId},isUp:function(){return this.comment.isLike.value>=1},isDown:function(){return this.comment.isLike.value<=-1}},methods:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(n,!0).forEach(function(e){o()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},l({_updateLike:"UPDATE_LIKE"}),{updateLike:function(t){var e=this;if(!this.redirectLogin()){var n=s.a.unvoteComment;return 1===t?n=s.a.upvoteComment:-1===t&&(n=s.a.downvoteComment),this._updateLike({isLike:{value:t},commentId:this.commentId}).then(function(){a.a.track(n,{CommentLevel:e.comment.level,CommentId:e.commentId})})}},vote:function(t){"up"===t?this.isUp?this.updateLike(0):this.updateLike(1):"down"===t&&(this.isDown?this.updateLike(0):this.updateLike(-1))}})}),d=n(0),h=Object(d.a)(p,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vote-buttons"},[n("a",{class:{up:t.isUp},attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.vote(t.UPVOTE)}}},[n("span",{staticClass:"icn-up"})]),t._v(" "),n("span",{staticClass:"seperator"}),t._v(" "),n("a",{class:{down:t.isDown},attrs:{href:"javascript:void(0);"},on:{click:function(e){return e.stopPropagation(),t.vote(t.DOWNVOTE)}}},[n("span",{staticClass:"icn-down"})])])},[],!1,null,null,null);e.a=h.exports},562:function(t,e,n){"use strict";(function(t){n(16),n(13),n(8),n(10),n(14),n(67),n(7);var r,o=n(1),i=n.n(o),a=n(489),s=n(29);function c(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(n,!0).forEach(function(e){i()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var m={userId:null,displayName:null,emojiStatus:null,avatarUrl:null,role:null,profileUrl:null,moderate:null,permissions:null,delegates:null};e.a={namespaced:!0,state:{auth:null,info:u({},m),commentedPostUrls:{},reportedPostUrls:{},likeMapping:{},quota:{}},getters:{isLoggedIn:function(t){return null!==t.info.userId},hasActivities:function(t,e,n){if(null===t.info.userId)return!1;if(t.info.moderate)return!0;var r=n.commentSystem.comment.url,o=t.commentedPostUrls,i=t.reportedPostUrls,a=!1;return o&&o[r]&&(a=!0),i&&i[r]&&(a=!0),a},canComment:function(t){return t.quota&&t.quota.count?t.quota.count>0:!!t.expiry&&Date.now()>t.expiry},waitTimeToComment:function(e){return e.quota?e.quota.wait>0&&t.secondsToHrs(e.quota.wait):0},canModerate:function(t){return t.info.moderate}},mutations:{setAuth:function(t,e){t.auth=e},setUserInfo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.info=e.user||u({},m),t.commentedPostUrls=e.commentedPostUrls||{},t.reportedPostUrls=e.reportedPostUrls||{},t.likeMapping=e.likeMapping||{},t.quota=e.quota||{}},updateCommentedPostUrls:function(t,e){t.commentedPostUrls=e},updateReportedPostUrls:function(t,e){t.reportedPostUrls=e},updateLikeMapping:function(t,e){t.likeMapping=e},updateQuota:function(t,e){e.wait&&(e.expiry=Date.now()+1e3*e.wait),t.quota=e}},actions:(r={},i()(r,s.b.FETCH_USER_INFO,function(t,e){var n=t.commit,r=t.state,o=e.auth;return o&&r.auth===o||n("setUserInfo"),n("setAuth",o),!o||r.info.userId?Promise.resolve():a.a.fetchUserInfo().then(function(t){n("setUserInfo",t)})}),i()(r,s.b.UPDATE_COMMENTED_POST_URLS,function(t,e){(0,t.commit)("updateCommentedPostUrls",u({},t.state.commentedPostUrls,{},e))}),i()(r,s.b.UPDATE_REPORTED_POST_URLS,function(t,e){(0,t.commit)("updateReportedPostUrls",u({},t.state.reportedPostUrls,{},e))}),i()(r,s.b.UPDATE_LIKE_MAPPING,function(t,e){(0,t.commit)("updateLikeMapping",u({},t.state.likeMapping,{},e))}),i()(r,s.b.UPDATE_QUOTA,function(t,e){(0,t.commit)("updateQuota",u({},t.state.quota,{},e))}),r)}}).call(this,n(62).default)},563:function(t,e,n){
/*! lozad.js - v1.14.0 - 2019-10-19
* https://github.com/ApoorvSaxena/lozad.js
* Copyright (c) 2019 Apoorv Saxena; Licensed MIT */
t.exports=function(){"use strict";var t="undefined"!=typeof document&&document.documentMode,e={rootMargin:"0px",threshold:0,load:function(e){if("picture"===e.nodeName.toLowerCase()){var n=document.createElement("img");t&&e.getAttribute("data-iesrc")&&(n.src=e.getAttribute("data-iesrc")),e.getAttribute("data-alt")&&(n.alt=e.getAttribute("data-alt")),e.append(n)}if("video"===e.nodeName.toLowerCase()&&!e.getAttribute("data-src")&&e.children){for(var r=e.children,o=void 0,i=0;i<=r.length-1;i++)(o=r[i].getAttribute("data-src"))&&(r[i].src=o);e.load()}if(e.getAttribute("data-src")&&(e.src=e.getAttribute("data-src")),e.getAttribute("data-srcset")&&e.setAttribute("srcset",e.getAttribute("data-srcset")),e.getAttribute("data-background-image"))e.style.backgroundImage="url('"+e.getAttribute("data-background-image").split(",").join("'),url('")+"')";else if(e.getAttribute("data-background-image-set")){var a=e.getAttribute("data-background-image-set").split(","),s=a[0].substr(0,a[0].indexOf(" "))||a[0];s=-1===s.indexOf("url(")?"url("+s+")":s,1===a.length?e.style.backgroundImage=s:e.setAttribute("style",(e.getAttribute("style")||"")+"background-image: "+s+"; background-image: -webkit-image-set("+a+"); background-image: image-set("+a+")")}e.getAttribute("data-toggle-class")&&e.classList.toggle(e.getAttribute("data-toggle-class"))},loaded:function(){}};function n(t){t.setAttribute("data-loaded",!0)}var r=function(t){return"true"===t.getAttribute("data-loaded")};return function(){var t,o,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:".lozad",a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=Object.assign({},e,a),c=s.root,u=s.rootMargin,m=s.threshold,l=s.load,p=s.loaded,d=void 0;return"undefined"!=typeof window&&window.IntersectionObserver&&(d=new IntersectionObserver((t=l,o=p,function(e,i){e.forEach(function(e){(0<e.intersectionRatio||e.isIntersecting)&&(i.unobserve(e.target),r(e.target)||(t(e.target),n(e.target),o(e.target)))})}),{root:c,rootMargin:u,threshold:m})),{observe:function(){for(var t=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document;return t instanceof Element?[t]:t instanceof NodeList?t:e.querySelectorAll(t)}(i,c),e=0;e<t.length;e++)r(t[e])||(d?d.observe(t[e]):(l(t[e]),n(t[e]),p(t[e])))},triggerLoad:function(t){r(t)||(l(t),n(t),p(t))},observer:d}}}()},564:function(t,e,n){"use strict";var r=n(490),o=n(0),i=Object(o.a)(r.a,void 0,void 0,!1,null,null,null);e.a=i.exports},565:function(t,e,n){"use strict";var r=n(39),o=n(88),i=n(35),a=n(230),s=n(331);r(r.P+r.R,"Promise",{finally:function(t){var e=a(this,o.Promise||i.Promise),n="function"==typeof t;return this.then(n?function(n){return s(e,t()).then(function(){return n})}:t,n?function(n){return s(e,t()).then(function(){throw n})}:t)}})},566:function(t,e,n){"use strict";var r=n(39),o=n(332)(6),i="findIndex",a=!0;i in[]&&Array(1)[i](function(){a=!1}),r(r.P+r.F*a,"Array",{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),n(191)(i)}}]);